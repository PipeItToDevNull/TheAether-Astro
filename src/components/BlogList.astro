---
import { getCollection } from 'astro:content';
import { LinkCard, CardGrid } from '@astrojs/starlight/components';

// Fetch the "blog" collection
let posts = await getCollection('blog');

// Sort posts by creation date (newest first)
posts = posts.sort((a, b) => {
  const dateA = new Date(a.data.created || '1970-01-01'); // Default to earliest date if missing
  const dateB = new Date(b.data.created || '1970-01-01');
  return dateB - dateA; // Sort descending
});

// Helper function to convert id's to human-readable titles
const toReadableTitle = (id) => {
  return id
    .replace(/-/g, ' ') // Replace dashes with spaces
    .replace(/\b\w/g, (char) => char.toUpperCase()); // Capitalize each word
};

// Helper function to format dates as yyyy/mm/dd
const formatDate = (date) => {
  if (!date) return 'No Creation Date';
  const d = new Date(date);
  return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
};
---

<section>
  {posts.map((post) => {
    const id = post.id.split('/').pop();
    const title = post.data.title || toReadableTitle(id);

    return (
      <LinkCard 
        title={title}
        href={`/blog/${post.id}`}
        description={`Created: ${formatDate(post.data.created)} | Last Updated: ${formatDate(post.data.modified)}`}
        style={{ whiteSpace: 'pre-line' }} // Ensures newlines are rendered
      />
    );
  })}
</section>
